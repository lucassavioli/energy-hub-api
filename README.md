# Energy Hub

This API simulates an energy hub that allows users to compare and get recommendations on different electricity suppliers and prices.

- **Users:** Users have smart meters tracking their energy usage.
- **Company:** Receive energy readings from smart meters and allow users to choose from who they want to use energy from.
- **Power Suppliers:** Provide energy to users with different tariffs.

# Functionalities

* Store eletricity reading given a **time** and **reading** value.
* Return electricity readings given a **smart-meter-id**.
* Compare the actual price plan with others given a **smart-meter-id**.
* Recommend price plans given a **smart-meter-id** returning.

# Main Tech Stack
**Backend:** FastAPI, Python 3.12
**Tests:** Pytest
**Dependency Manager:** Poetry
**DevOps:** Docker, GitHub Actions, Trivy
**Documentation:** ReDoc, Swagger UI

## Users

Below we have pre defined users to test the service and share their energy
data. These values are used in the code and in the following examples too.

| User    | Smart Meter ID  | Power Supplier        |
| ------- | --------------- | --------------------- |
| Sarah   | `smart-meter-0` | Energy Supplier I     |
| Peter   | `smart-meter-1` | Energy Supplier II    |
| Charlie | `smart-meter-2` | Energy Supplier I     |
| Andrea  | `smart-meter-3` | Energy Supplier III   |
| Alex    | `smart-meter-4` | Energy Supplier II    |

## Requirements

The project requires [Python 3.12](https://www.python.org/downloads/release/python-3120/) or higher and the [Poetry](https://python-poetry.org/) package manager.

# Installation

After installing poetry, install the project dependencies with:

```console
poetry install --with ci,tests
```
This will install main dependencies together with optional ones.

### Pre-commit hooks
The project is offering [pre-commit](https://pre-commit.com/) hooks, please install them via
```console
pre-commit install
```

# Usage

### Run the application

Run the application which will be listening on port `8020`.

```console
poetry run python app.py
```
### Run the tests

Run all tests

```console
poetry run pytest
```

# DevOps
### Building Docker Image
The application can be containerized by using:
```console
docker build -t energy-hub .
```

### Building Docker image
Once the docker image is built, it can be run with:
```console
docker run -p 8020:8020 energy-hub
```

### GitHub Actions
Each commit in the main branch will trigger a pipeline which will run unit tests and different linting tools.
When successful it will also containerize the application, finally its scans the docker image for vulnerabilities with [Trivy](https://aquasecurity.github.io/trivy/v0.49/).

# API

### Autogenerated Documentations
The application will automatically generate documentations and provide them under:

- [Swagger UI](https://github.com/swagger-api/swagger-ui) > http://localhost:8020/docs
- [ReDoc](https://github.com/Redocly/redoc) > http://localhost:8020/redoc


